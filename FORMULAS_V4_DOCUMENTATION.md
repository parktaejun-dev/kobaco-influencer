# 📐 개선된 인플루언서 광고비 산정 산식 (v4.0)

> **카테고리 가중치 제외**, 실무 적용 가능한 3가지 개선사항 반영

---

## 🔢 전체 계산 흐름

```
1. CPM 기반 비용 계산
2. 최근 90일 CPM 계산 (선택적)
3. 티어별 최소 보장 금액 조회
4. 기본 비용 결정 (MAX 선택)
5. 참여율 보정 계수 산출
6. 참여 질 보정 계수 산출 (신규)
7. 최종 참여 계수 = 참여율 계수 × 참여 질 계수
8. 콘텐츠 포맷 프리미엄 적용 (신규)
9. 글로벌 최종 비용 계산
10. 한국 시장 조정 계수 적용
11. 한국 최종 비용 계산
12. 비용 범위 산정 (±15%)
```

---

## 📝 상세 산식

### STEP 1: CPM 기반 비용 계산

```
CPM_기본 = 39,000원 (1,000뷰당)

CPM_비용 = (평균_조회수 / 1,000) × CPM_기본
```

**예시:**
- 평균 조회수 80,000회 → (80,000 / 1,000) × 39,000 = 3,120,000원

---

### STEP 2: 최근 90일 CPM 계산 (선택적)

```
IF 최근_90일_평균_조회수가 있으면:
    최근_CPM_비용 = (최근_90일_평균_조회수 / 1,000) × CPM_기본
ELSE:
    최근_CPM_비용 = 0
```

**목적:** "죽은 채널" 방지 (구독자는 많은데 최근 조회수가 급감한 경우)

---

### STEP 3: 티어별 최소 보장 금액

```
IF 구독자 < 10,000:
    티어_최소값 = 350,000원
ELIF 구독자 < 100,000:
    티어_최소값 = 2,500,000원
ELIF 구독자 < 500,000:
    티어_최소값 = 5,200,000원
ELIF 구독자 < 1,000,000:
    티어_최소값 = 19,500,000원
ELSE:  # 1,000,000+
    티어_최소값 = 47,500,000원
```

---

### STEP 4: 기본 비용 결정

```
IF 최근_CPM_비용 > 0:
    기본_비용 = MAX(CPM_비용, 최근_CPM_비용, 티어_최소값)
ELSE:
    기본_비용 = MAX(CPM_비용, 티어_최소값)
```

**논리:** 세 값 중 가장 높은 값을 선택하여 인플루언서 보호

---

### STEP 5: 참여율 보정 계수

```
IF 참여율 >= 10:
    참여율_계수 = 1.5
    참여율_등급 = "최상 (10%+)"
ELIF 참여율 >= 7:
    참여율_계수 = 1.3
    참여율_등급 = "매우 높음 (7-10%)"
ELIF 참여율 >= 5:
    참여율_계수 = 1.2
    참여율_등급 = "높음 (5-7%)"
ELIF 참여율 >= 3:
    참여율_계수 = 1.1
    참여율_등급 = "양호 (3-5%)"
ELIF 참여율 >= 2:
    참여율_계수 = 1.0
    참여율_등급 = "보통 (2-3%)"
ELIF 참여율 >= 1:
    참여율_계수 = 0.9
    참여율_등급 = "낮음 (1-2%)"
ELSE:  # < 1%
    참여율_계수 = 0.85
    참여율_등급 = "매우 낮음 (<1%)"
```

**참고:** 기존 산식 유지

---

### STEP 6: 참여 질 보정 계수 (신규 추가)

```
IF 평균_좋아요_수 == 0:
    참여_질_계수 = 1.0
ELSE:
    댓글_좋아요_비율 = 평균_댓글_수 / 평균_좋아요_수

    IF 댓글_좋아요_비율 >= 0.15:
        참여_질_계수 = 1.1
        참여_질_등급 = "대화형 커뮤니티 (우수)"
    ELIF 댓글_좋아요_비율 < 0.05:
        참여_질_계수 = 0.9
        참여_질_등급 = "이벤트형 (저품질)"
    ELSE:
        참여_질_계수 = 1.0
        참여_질_등급 = "정상 범위"
```

**예시:**
- 좋아요 2,000 / 댓글 300 → 비율 0.15 → 계수 1.1 (우수)
- 좋아요 2,000 / 댓글 50 → 비율 0.025 → 계수 0.9 (저품질)

---

### STEP 7: 최종 참여 계수

```
최종_참여_계수 = 참여율_계수 × 참여_질_계수
```

**예시:**
- 참여율 3.5% → 참여율_계수 1.1
- 댓글/좋아요 0.15 → 참여_질_계수 1.1
- 최종_참여_계수 = 1.1 × 1.1 = 1.21

---

### STEP 8: 콘텐츠 포맷 프리미엄 (신규 추가)

```
콘텐츠_포맷에 따라 선택:

"단순 노출형" (브이로그 중 제품 삽입):
    포맷_계수 = 1.0

"제품 리뷰" (단독 리뷰 영상):
    포맷_계수 = 1.2

"비교/추천" (여러 제품 비교 또는 추천 영상):
    포맷_계수 = 1.35

"사용후기" (장기 사용 리뷰):
    포맷_계수 = 1.35

"장기 캠페인" (3회 이상 연재형):
    포맷_계수 = 1.5

"기본" (미지정):
    포맷_계수 = 1.0
```

**적용 방법:** UI에서 사용자가 선택하도록 드롭다운 제공

---

### STEP 9: 글로벌 최종 비용

```
글로벌_최종_비용 = 기본_비용 × 최종_참여_계수 × 포맷_계수
```

**예시:**
- 기본 비용: 3,120,000원
- 최종 참여 계수: 1.21
- 포맷 계수: 1.2 (제품 리뷰)
- 글로벌 비용 = 3,120,000 × 1.21 × 1.2 = 4,529,280원

---

### STEP 10: 한국 시장 조정 계수

```
IF 구독자 < 100,000:
    한국_시장_계수 = 0.85
ELSE:
    한국_시장_계수 = 0.75
```

**참고:** 기존 로직 유지 (검증 결과 "합리적"으로 판정됨)

---

### STEP 11: 한국 최종 비용

```
한국_최종_비용 = 글로벌_최종_비용 × 한국_시장_계수
```

**예시:**
- 글로벌 비용: 4,529,280원
- 한국 계수: 0.85 (10만 이하 구독자)
- 한국 최종 비용 = 4,529,280 × 0.85 = 3,849,888원 → **3,850,000원**

---

### STEP 12: 비용 범위 산정

```
최소_비용 = 한국_최종_비용 × 0.85
최대_비용 = 한국_최종_비용 × 1.15
```

**예시:**
- 최종 비용: 3,850,000원
- 최소: 3,272,500원
- 최대: 4,427,500원

---

## 📊 입력 데이터 (함수 파라미터)

### 필수 입력값
```python
subscriber_count        # 구독자 수 (int)
avg_views              # 평균 조회수 (int)
engagement_rate        # 참여율 (float, %)
avg_likes              # 평균 좋아요 수 (int)
avg_comments           # 평균 댓글 수 (int)
```

### 선택 입력값
```python
recent_90day_avg_views # 최근 90일 평균 조회수 (int, optional, default=None)
content_format         # 콘텐츠 포맷 (str, optional, default="기본")
```

**content_format 선택지:**
- "단순 노출형"
- "제품 리뷰"
- "비교/추천"
- "사용후기"
- "장기 캠페인"
- "기본"

---

## 📤 출력 데이터 (반환값)

```python
{
    'base_cost_cpm': int,              # CPM 기반 비용
    'recent_cpm_cost': int,            # 최근 90일 CPM 비용 (있는 경우)
    'tier_base': int,                  # 티어 최소 보장액
    'base_cost': int,                  # 기본 비용 (MAX 선택 결과)

    'engagement_rate': float,          # 입력된 참여율
    'engagement_multiplier': float,    # 참여율 계수
    'engagement_level': str,           # 참여율 등급

    'comment_like_ratio': float,       # 댓글/좋아요 비율
    'quality_multiplier': float,       # 참여 질 계수
    'quality_level': str,              # 참여 질 등급

    'final_engagement_multiplier': float,  # 최종 참여 계수
    'format_multiplier': float,        # 콘텐츠 포맷 계수
    'content_format': str,             # 선택된 콘텐츠 포맷

    'global_final_cost': int,          # 글로벌 최종 비용
    'korea_adjustment': float,         # 한국 시장 계수
    'korea_final_cost': int,           # 한국 최종 비용

    'min_cost': int,                   # 최소 비용 (×0.85)
    'max_cost': int                    # 최대 비용 (×1.15)
}
```

---

## 🔍 계산 예시

### 예시 1: 기본 케이스
**입력:**
- 구독자: 150,000
- 평균 조회수: 80,000
- 참여율: 3.5%
- 평균 좋아요: 2,000
- 평균 댓글: 200
- 콘텐츠 포맷: "기본"

**계산:**
1. CPM 비용 = 80,000 / 1,000 × 39,000 = 3,120,000원
2. 티어 최소 = 2,500,000원 (10만~50만)
3. 기본 비용 = MAX(3,120,000, 2,500,000) = **3,120,000원**
4. 참여율 계수 = 1.1 (3~5% 구간)
5. 댓글/좋아요 = 200/2,000 = 0.1 → 질 계수 = 1.0
6. 최종 참여 계수 = 1.1 × 1.0 = 1.1
7. 포맷 계수 = 1.0 (기본)
8. 글로벌 비용 = 3,120,000 × 1.1 × 1.0 = 3,432,000원
9. 한국 계수 = 0.75 (10만 이상)
10. **한국 최종 = 3,432,000 × 0.75 = 2,574,000원**
11. 범위: 2,187,900원 ~ 2,960,100원

---

### 예시 2: 모든 개선 요소 적용
**입력:**
- 구독자: 150,000
- 평균 조회수: 80,000
- 최근 90일 조회수: 75,000
- 참여율: 3.5%
- 평균 좋아요: 2,000
- 평균 댓글: 300
- 콘텐츠 포맷: "제품 리뷰"

**계산:**
1. CPM 비용 = 3,120,000원
2. 최근 CPM = 75,000 / 1,000 × 39,000 = 2,925,000원
3. 티어 최소 = 2,500,000원
4. 기본 비용 = MAX(3,120,000, 2,925,000, 2,500,000) = **3,120,000원**
5. 참여율 계수 = 1.1
6. 댓글/좋아요 = 300/2,000 = 0.15 → 질 계수 = 1.1
7. 최종 참여 계수 = 1.1 × 1.1 = 1.21
8. 포맷 계수 = 1.2 (제품 리뷰)
9. 글로벌 비용 = 3,120,000 × 1.21 × 1.2 = 4,529,280원
10. 한국 계수 = 0.75
11. **한국 최종 = 4,529,280 × 0.75 = 3,396,960원**
12. 범위: 2,887,416원 ~ 3,906,504원

**기존 대비 차이:** +822,960원 (+32%)

---

## ⚙️ 구현 시 주의사항

1. **0으로 나누기 방지**
   - 평균_좋아요_수 = 0일 때 → 참여_질_계수 = 1.0

2. **NULL 값 처리**
   - recent_90day_avg_views가 None 또는 0이면 → 해당 계산 스킵

3. **정수 변환**
   - 모든 금액은 int()로 변환 (소수점 버림)

4. **반올림**
   - 참여율, 비율 등은 소수점 2자리까지 반올림

5. **UI 연동**
   - content_format은 드롭다운으로 사용자가 선택
   - 기본값은 "기본"으로 설정

---

## 🎯 주요 개선사항 요약

### 1. 최근 90일 CPM (죽은 채널 방지)
- 구독자는 많지만 최근 활동이 없는 채널을 걸러냄
- 기본 비용 선택 시 세 값 중 최댓값 사용

### 2. 참여 질 보정 (댓글/좋아요 비율)
- 단순 좋아요만 많은 채널과 진짜 참여도 높은 채널 구분
- 댓글/좋아요 비율 15% 이상: +10% 보너스
- 댓글/좋아요 비율 5% 미만: -10% 페널티

### 3. 콘텐츠 포맷 프리미엄
- 광고 형태에 따른 차등 가격 적용
- 단순 노출 (1.0x) ~ 장기 캠페인 (1.5x)
- 광고주의 ROI를 고려한 합리적 가격 책정

---

이 산식을 AI에게 전달하시면 바로 코딩 가능합니다! 🚀
